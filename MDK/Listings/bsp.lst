C51 COMPILER V9.60.0.0   BSP                                                               11/21/2022 12:01:03 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE BSP
OBJECT MODULE PLACED IN .\Objects\bsp.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\BSP\bsp.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\BSP;..\BSP\bsp_key;..\US
                    -ER;..\BSP\bsp_lcd1602;..\middleware\FIFO;..\middleware\LIST;..\middleware) DEBUG OBJECTEXTEND PRINT(.\Listings\bsp.lst) 
                    -TABS(2) OBJECT(.\Objects\bsp.obj)

line level    source

   1          /*
   2           * @Author: liubotao
   3           * @Date: 2022-11-18 00:32:28
   4           * @LastEditors: liubotao
   5           * @LastEditTime: 2022-11-21 12:00:41
   6           * @FilePath: \test_51\BSP\bsp.c
   7           * @Description: 中断和驱动初始化
   8           *
   9           */
  10          #include "bsp.h"
  11          #include "fifo.h"
  12          static void task10ms();
  13          static void task5ms();
  14          
  15          extern FIFO f_K;
  16          self_t KeyValue_ind; //全局函数，独立键值
  17          
  18          void bspInit()              //硬件初始化
  19          {
  20   1          bsp_InitKeyVar();       //按键初始化
  21   1          initLcd1602();          //lcd初始化
  22   1          timer0Init();           //中断初始化
  23   1      }
  24          
  25          void timer0Init()           //1ms中断初始化
  26          {
  27   1          TMOD |= 0X10;
  28   1      
  29   1          TH1 = 0XFC; 
  30   1          TL1 = 0X18;
  31   1          ET1 = 1;
  32   1          EA = 1;
  33   1          TR1 = 1;
  34   1      }
  35          
  36          
  37          static void task10ms()      //10ms任务
  38          {
  39   1          // matrixKeyScan_1();
  40   1          // matrixKeyScan_2();
  41   1          //matrixKeyScan_3();
  42   1          bsp_KeyScan();
  43   1      }
  44          
  45          static void task5ms()      //10ms任务
  46          {
  47   1          // matrixKeyScan_1();
  48   1          // matrixKeyScan_2();
  49   1           matrixKeyScan_3();
  50   1           KeyValue_ind=deQueue(&f_K);
  51   1            switch (KeyValue_ind)
  52   1          {
  53   2          case KEY_1_DOWN:
C51 COMPILER V9.60.0.0   BSP                                                               11/21/2022 12:01:03 PAGE 2   

  54   2            LcdShowStr(0, 0, "KEY_1_DOWN");
  55   2            break;
  56   2          case KEY_1_UP:
  57   2            LcdShowStr(0, 0, "KEY_1_UP  ");
  58   2            break;
  59   2          case KEY_1_LONG:
  60   2            LcdShowStr(0, 0, "KEY_1_LONG");
  61   2            break;
  62   2          case KEY_2_DOWN:
  63   2            LcdShowStr(0, 0, "KEY_2_DOWN");
  64   2            break;
  65   2          case KEY_2_UP:
  66   2            LcdShowStr(0, 0, "KEY_2_UP  ");
  67   2            break;
  68   2          case KEY_2_LONG:
  69   2            LcdShowStr(0, 0, "KEY_2_LONG");
  70   2            break;
  71   2          default:
  72   2            break;
  73   2          }
  74   1      
  75   1      }
  76          void Timer1() interrupt 3   //中断服务函数
  77          {
  78   1          static int time_num5;    //中断次数，一次10ms
  79   1          static int time_num10;    //中断次数，一次10ms
  80   1      
  81   1          TH1 = 0XFC; 
  82   1          TL1 = 0X18;
  83   1          time_num5++;
  84   1          time_num10++;
  85   1          if (time_num5 == 5)     // 10ms
  86   1          {
  87   2              time_num5 = 0;
  88   2              task5ms();
  89   2          }
  90   1              if (time_num10 == 10)     // 10ms
  91   1          {
  92   2              time_num10 = 0;
  93   2              
  94   2            task10ms();
  95   2          }
  96   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    225    ----
   CONSTANT SIZE    =     66    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
